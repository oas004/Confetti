<templateSet group="aaConfetti">
  <template name="xrCreateApolllo" value="// Create Apollo client with normalized cache&#10;private val apolloClient = ApolloClient.Builder()&#10;    .serverUrl(&quot;http://10.0.2.2:8080/graphql?conference=$conferenceName&quot;)&#10;    .normalizedCache(MemoryCacheFactory(10_000_000).chain(SqlNormalizedCacheFactory(getDatabaseName(conferenceName))))&#10;    .build()&#10;" description="" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="KOTLIN" value="true" />
    </context>
  </template>
  <template name="xrConfName" value="val conferenceName = &quot;kotlinconf2023&quot;" description="" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="KOTLIN" value="true" />
    </context>
  </template>
  <template name="xrSessionsFlow" value="// Gets list of sessions from backend and then observes the cache for any changes&#10;val sessions = apolloClient.query(GetSessionsQuery()).watch().map {&#10;    it.dataAssertNoErrors.sessions.map { it.sessionDetails }&#10;}&#10;" description="" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="KOTLIN" value="true" />
    </context>
  </template>
  <template name="xrSessionsMap" value="// Group sessions by date&#10;val sessionsByDateMap: Flow&lt;Map&lt;LocalDate, List&lt;SessionDetails&gt;&gt;&gt; = sessions.map {&#10;    it.groupBy { it.start.date }&#10;}&#10;" description="" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="KOTLIN" value="true" />
    </context>
  </template>
  <template name="xvSessionUIState" value="sealed interface SessionsUiState {&#10;    object Loading : SessionsUiState&#10;&#10;    data class Success(&#10;        val conferenceName: String,&#10;        val confDates: List&lt;LocalDate&gt;,&#10;        val sessionsByStartTimeList: List&lt;Map&lt;String, List&lt;SessionDetails&gt;&gt;&gt;&#10;    ) : SessionsUiState&#10;}&#10;" description="" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="KOTLIN" value="true" />
    </context>
  </template>
  <template name="xGraphqlQuery" value="query GetSessions {&#10;    sessions {&#10;        ...SessionDetails&#10;    }&#10;}&#10;&#10;&#10;fragment SessionDetails on Session {&#10;    id&#10;    title&#10;    type&#10;    start&#10;    description&#10;    speakers {&#10;      id&#10;      name&#10;    }&#10;}&#10;" description="" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="CMAKE" value="false" />
      <option name="GROOVY" value="false" />
      <option name="HTML" value="false" />
      <option name="JAVA_CODE" value="false" />
      <option name="JSON" value="false" />
      <option name="KOTLIN" value="false" />
      <option name="OTHER" value="true" />
      <option name="Properties" value="false" />
      <option name="SHELL_SCRIPT" value="false" />
      <option name="XML" value="false" />
      <option name="XML_ATTRIBUTE" value="false" />
      <option name="c" value="false" />
      <option name="cpp" value="false" />
      <option name="objc" value="false" />
    </context>
  </template>
  <template name="xvViewModel" value="class ConfettiViewModel: KMMViewModel() {&#10;    private val repository = ConfettiRepository()&#10;    &#10;    $END$&#10;}" description="" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="KOTLIN" value="true" />
    </context>
  </template>
  <template name="xvCreateUIState" value="@NativeCoroutinesState&#10;val uiState: StateFlow&lt;SessionsUiState&gt; = repository.sessionsByDateMap.map { sessionsByDateMap -&gt;&#10;&#10;    val confDates = sessionsByDateMap.keys.toList().sorted()&#10;    val sessionsByStartTimeList = groupSessionsByStartTime(confDates, sessionsByDateMap)&#10;    SessionsUiState.Success(repository.conferenceName, confDates, sessionsByStartTimeList)&#10;&#10;}.stateIn(viewModelScope, SharingStarted.WhileSubscribed(), SessionsUiState.Loading)&#10;" description="" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="KOTLIN" value="true" />
    </context>
  </template>
  <template name="xuSessionView" value="@Composable&#10;fun SessionView(session: SessionDetails) {&#10;    ListItem(&#10;        headlineText = { Text(session.title) },&#10;        supportingText = { Text(session.sessionSpeakerInfo(), fontWeight = FontWeight.Bold) },&#10;    )&#10;}&#10;" description="" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="KOTLIN" value="true" />
    </context>
  </template>
  <template name="xuSessionListView" value="@Composable&#10;fun SessionListView(uiState: SessionsUiState.Success) {&#10;    val sessionsMap = uiState.sessionsByStartTimeList[0]&#10;    LazyColumn {&#10;        sessionsMap.forEach { sessions -&gt;&#10;            items(sessions.value) { session -&gt;&#10;                SessionView(session)&#10;            }&#10;        }&#10;    }&#10;}" description="" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="KOTLIN" value="true" />
    </context>
  </template>
  <template name="xvGroupByStartTime" value="private fun groupSessionsByStartTime(confDates: List&lt;LocalDate&gt;, sessionsByDateMap: Map&lt;LocalDate, List&lt;SessionDetails&gt;&gt;): MutableList&lt;Map&lt;String, List&lt;SessionDetails&gt;&gt;&gt; {&#10;    val sessionsByStartTimeList = mutableListOf&lt;Map&lt;String, List&lt;SessionDetails&gt;&gt;&gt;()&#10;    confDates.forEach { confDate -&gt;&#10;        val sessions = sessionsByDateMap[confDate] ?: emptyList()&#10;        val sessionsByStartTime = sessions.groupBy {&#10;            dateTimeFormatter.format(it.start, currentSystemDefault(), &quot;HH:mm&quot;)&#10;        }&#10;        sessionsByStartTimeList.add(sessionsByStartTime)&#10;    }&#10;    return sessionsByStartTimeList&#10;}&#10;" description="" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="KOTLIN" value="true" />
    </context>
  </template>
  <template name="xjMain" value="suspend fun main() {&#10;    val repo = ConfettiRepository()&#10;&#10;    repo.sessions.collect { sessions -&gt;&#10;        sessions.forEach { session -&gt;&#10;            println(&quot;${session.start}  ${session.title}&quot;)&#10;        }&#10;    }&#10;}" description="" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="KOTLIN" value="true" />
    </context>
  </template>
  <template name="xuSessionListScreen" value="@Composable&#10;fun SessionListScreen(viewModel: ConfettiViewModel = getViewModel()) {&#10;    val uiState by viewModel.uiState.collectAsStateWithLifecycle()&#10;&#10;    when (val state = uiState) {&#10;        SessionsUiState.Loading -&gt;&#10;            Column(modifier = Modifier.fillMaxSize().wrapContentSize(Alignment.Center)) {&#10;                CircularProgressIndicator()&#10;            }&#10;&#10;        is SessionsUiState.Success -&gt; {&#10;            SessionListView(state)&#10;        }&#10;    }&#10;}" description="" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="KOTLIN" value="true" />
    </context>
  </template>
  <template name="xuMainActivity" value="class MainActivity : ComponentActivity() {&#10;&#10;    override fun onCreate(savedInstanceState: Bundle?) {&#10;        super.onCreate(savedInstanceState)&#10;&#10;        setContent {&#10;            ConfettiTheme {&#10;                SessionListScreen()&#10;            }&#10;        }&#10;    }&#10;}" description="" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="KOTLIN" value="true" />
    </context>
  </template>
  <template name="xuHorizontalPager" value="HorizontalPager(pageCount = uiState.confDates.size, state = pagerState) { page -&gt;&#10;    $SELECTION$$END$&#10;}" description="" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="KOTLIN" value="true" />
    </context>
  </template>
  <template name="xuPagerState" value="val pagerState = rememberPagerState()" description="" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="KOTLIN" value="true" />
    </context>
  </template>
  <template name="xuScaffold" value="Scaffold(&#10;    topBar = { CenterAlignedTopAppBar(title = { Text(uiState.conferenceName) }) }&#10;) {&#10;    Column(Modifier.padding(it)) {&#10;    &#10;    &#10;        $SELECTION$$END$&#10;    }&#10;}&#10;" description="" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="KOTLIN" value="true" />
    </context>
  </template>
  <template name="xuTabRow" value="SessionListTabRow(pagerState, uiState)" description="" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="KOTLIN" value="true" />
    </context>
  </template>
  <template name="xuSessionTimeView" value="item {&#10;    Column(Modifier.padding(horizontal = 16.dp, vertical = 8.dp)) {&#10;        Text(sessions.key, fontWeight = FontWeight.Bold, color = MaterialTheme.colorScheme.primary)&#10;        Divider()&#10;    }&#10;}&#10;" description="" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="KOTLIN" value="true" />
    </context>
  </template>
  <template name="xuRoomText" value="overlineText = { Text(session.room.name) }" toReformat="false" toShortenFQNames="true">
    <context>
      <option name="KOTLIN" value="true" />
    </context>
  </template>
</templateSet>